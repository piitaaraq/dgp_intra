{% extends "base.html" %} {% block title %}Events – DgP Intra{% endblock %} {%
block content %}
<!-- Hero -->
<div class="p-4 p-md-5 mb-4 hero bg-accent-2">
  <h1 class="display-6 fw-semibold mb-2">
    Kommende arrangementer – næste 6 måneder
  </h1>
  <p class="fs-5 mb-0">
    Se planlagte arrangementer, tilmeld/afmeld dig og følg fristerne. Arrangører
    kan slette egne arrangementer.
  </p>
</div>

<!-- Intro callout -->
<div class="alert alert-soft mb-4">
  For at oprette et arrangement, brug knappen
  <strong>Opret nyt arrangement</strong> nedenfor.
</div>

{% if events %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  {% for event in events %}
  <div class="col">
    <div class="card h-100 border-0 shadow-sm rounded-3">
      <div class="card-header bg-accent-1 border-accent-1 rounded-top-3">
        <h2 class="h5 mb-0">{{ event.name }}</h2>
      </div>

      <div class="card-body d-flex flex-column">
        <div class="small text-body-secondary mb-2">
          Arrangør: {{ event.organizer.name }}
        </div>
        <div class="mb-2">
          {{ event.date.strftime('%d-%m-%Y') }} kl. {{
          event.time.strftime('%H:%M') }}
        </div>

        {% if event.deadline %}
        <div class="text-muted small mb-2">
          Tilmeldingsfrist: {{ event.deadline.strftime('%d-%m-%Y') }}
        </div>
        {% endif %}

        <div class="mt-auto d-grid gap-2">
          <a href="{{ url_for('events.detail', event_id=event.id) }}"
            class="btn btn-outline-secondary btn-sm rounded-2">
            Se mere
          </a>

          {% if event.id in user_registrations %}
          <form action="{{ url_for('events.unregister', event_id=event.id) }}" method="post">
            <button class="btn btn-light btn-sm w-100 rounded-2" type="submit">
              Afmeld
            </button>
          </form>
          {% elif event.deadline and event.deadline <= current_date %} <div class="text-muted small">Tilmeldingsfristen
            er udløbet
        </div>
        {% else %}
        <form action="{{ url_for('events.register', event_id=event.id) }}" method="post">
          <button class="btn btn-brand btn-sm w-100 rounded-2" type="submit">
            Tilmeld
          </button>
        </form>
        {% endif %} {% if event.organizer_id == current_user.id %}
        <form action="{{ url_for('events.delete', event_id=event.id) }}" method="post"
          onsubmit="return confirm('Er du sikker på, at du vil slette dette arrangement?');">
          <button class="btn btn-outline-danger btn-sm w-100 rounded-2" type="submit">
            Slet
          </button>
        </form>
        {% endif %}
      </div>
    </div>

    {% if event.id in user_registrations %}
    <div class="card-footer text-bg-success text-center rounded-bottom-3">
      Tilmeldt
    </div>
    {% endif %}
  </div>
</div>
{% endfor %}
</div>
{% else %}
<div class="alert alert-soft">Ingen arrangementer fundet.</div>
{% endif %}

<hr class="mt-5" />

<div class="d-flex flex-wrap gap-2">
  <a class="btn btn-link" href="{{ url_for('dashboard.view') }}">← Tilbage til dashboard</a>
  <a class="btn btn-primary" href="{{ url_for('events.create') }}">Opret nyt arrangement</a>
</div>
{% endblock %}