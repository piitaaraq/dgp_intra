{% extends "base.html" %}
{% block title %}Køb Klippekort - DgP Intra{% endblock %}

{% block content %}
<div class="container-fluid px-0 px-sm-2">
    <!-- Hero section -->
    <div class="p-4 p-md-5 mb-4 hero bg-accent-2">
        <div class="container-fluid py-2">
            <h1 class="display-6 fw-semibold mb-2">Køb Klippekort</h1>
            <p class="fs-5 mb-2">Køb klip til frokostordningen med MobilePay. Betalingen sker med det samme, og klippene
                tilføjes automatisk til din konto.</p>

            <div class="d-flex flex-wrap gap-2 align-items-center">
                <span class="badge text-bg-brand rounded-pill">Dine nuværende klip: {{ current_user.credit }}</span>
                <span class="badge bg-light text-dark border rounded-pill">Pris pr. klip: {{ price_per_clip }}
                    kr.</span>
            </div>
        </div>
    </div>

    <div class="row g-4 justify-content-center">
        <div class="col-lg-8">

            <!-- Information card -->
            <div class="card border-0 shadow-sm rounded-3 mb-4">
                <div class="card-header bg-accent-1 border-accent-1 rounded-top-3">
                    <h2 class="h5 mb-0">Sådan fungerer det</h2>
                </div>
                <div class="card-body">
                    <ol class="mb-0">
                        <li class="mb-2">Vælg antal klip (1 eller 5)</li>
                        <li class="mb-2">Tryk på "Betal med MobilePay"</li>
                        <li class="mb-2">Godkend betalingen i MobilePay-appen</li>
                        <li>Klippene tilføjes automatisk til din konto</li>
                    </ol>
                </div>
            </div>

            <!-- Purchase options -->
            <form method="POST" action="{{ url_for('klippekort.cart') }}">
                <div class="row g-3">

                    <!-- Option 1: Single clip -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm rounded-3">
                            <div class="card-body d-flex flex-column">
                                <div class="text-center mb-3">
                                    <div class="display-4 fw-bold text-brand">1</div>
                                    <div class="text-muted">klip</div>
                                </div>

                                <div class="mb-3 text-center">
                                    <div class="h3 mb-0">{{ price_per_clip }} kr.</div>
                                    <small class="text-muted">inkl. moms</small>
                                </div>

                                <div class="alert alert-soft mb-3">
                                    Perfekt til enkeltstående måltider
                                </div>

                                <div class="mt-auto">
                                    <button type="submit" name="amount" value="1"
                                        class="btn btn-outline-dark w-100 rounded-2">
                                        <i class="bi bi-phone me-2"></i>Betal med MobilePay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Option 2: Five clips -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm rounded-3 position-relative">
                            <!-- Popular badge -->
                            <span
                                class="position-absolute top-0 start-50 translate-middle badge text-bg-brand rounded-pill">
                                Populært valg
                            </span>

                            <div class="card-body d-flex flex-column">
                                <div class="text-center mb-3">
                                    <div class="display-4 fw-bold text-brand">5</div>
                                    <div class="text-muted">klip</div>
                                </div>

                                <div class="mb-3 text-center">
                                    <div class="h3 mb-0">{{ price_per_clip * 5 }} kr.</div>
                                    <small class="text-muted">inkl. moms</small>
                                </div>

                                <div class="alert alert-soft mb-3">
                                    Perfekt til en hel uge
                                </div>

                                <div class="mt-auto">
                                    <button type="submit" name="amount" value="5" class="btn btn-brand w-100 rounded-2">
                                        <i class="bi bi-phone me-2"></i>Betal med MobilePay
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </form>

            <!-- Info about legacy system -->
            <div class="card border-0 shadow-sm rounded-3 mt-4">
                <div class="card-body">
                    <h3 class="h6 mb-2">Kan ikke bruge MobilePay?</h3>
                    <p class="text-body-secondary mb-2">Hvis du foretrækker at betale kontant eller har problemer med
                        MobilePay, kan du stadig bruge den <a href="{{ url_for('credit.buy') }}">manuelle
                            købsmetode</a>, hvor køkkenet markerer din betaling.</p>
                    <a href="{{ url_for('credit.buy') }}" class="btn btn-sm btn-outline-secondary rounded-pill">
                        Gå til manuel køb
                    </a>
                </div>
            </div>

            <!-- View ledger -->
            <div class="text-center mt-4">
                <a href="{{ url_for('credit.ledger') }}" class="btn btn-outline-dark rounded-pill">
                    <i class="bi bi-list-ul me-2"></i>Se din kreditoversigt
                </a>
            </div>

        </div>
    </div>
</div>
{% endblock %}