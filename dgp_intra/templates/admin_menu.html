{% extends "base.html" %}
{% block title %}Ugemenu â€“ DgP Intra{% endblock %}
{% block content %}

<!-- Hero -->
<div class="p-4 p-md-5 mb-4 hero bg-accent-2">
  <h1 class="display-6 fw-semibold mb-2">ğŸ½ï¸ Ugemenu for uge {{ current_week }}</h1>
  <p class="mb-0">Opdater kÃ¸kkenets frokostmenu for personale og patienter.</p>
</div>

<div class="row g-4">
  <!-- Staff Menu -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm rounded-3 h-100">
      <div class="card-header bg-accent-1 border-accent-1 rounded-top-3 py-3">
        <h2 class="h5 mb-0">ğŸ“ Personale Menu</h2>
      </div>
      <div class="card-body p-4">
        <div class="alert alert-info border-0 rounded-3 mb-4">
          <small>ğŸ’¡ Menu for ansatte</small>
        </div>

        <form method="POST" class="d-flex flex-column gap-3">
          <input type="hidden" name="menu_type" value="weekly" />
          <input type="hidden" name="next" value="{{ url_for('admin.menu_input') }}" />

          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2" for="monday">
              <span class="badge bg-primary rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">1</span>
              Mandag
            </label>
            <textarea id="monday" name="monday" class="form-control rounded-2" rows="2"
              placeholder="f.eks. Hjemmelavet lasagne med salat">{{ weekly_menu.monday if weekly_menu else '' }}</textarea>
          </div>

          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2" for="tuesday">
              <span class="badge bg-primary rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">2</span>
              Tirsdag
            </label>
            <textarea id="tuesday" name="tuesday" class="form-control rounded-2" rows="2"
              placeholder="f.eks. Grillet kylling med ris">{{ weekly_menu.tuesday if weekly_menu else '' }}</textarea>
          </div>

          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2" for="wednesday">
              <span class="badge bg-primary rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">3</span>
              Onsdag
            </label>
            <textarea id="wednesday" name="wednesday" class="form-control rounded-2" rows="2"
              placeholder="f.eks. Fiskefilet med kartofler">{{ weekly_menu.wednesday if weekly_menu else '' }}</textarea>
          </div>

          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2" for="thursday">
              <span class="badge bg-primary rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">4</span>
              Torsdag
            </label>
            <textarea id="thursday" name="thursday" class="form-control rounded-2" rows="2"
              placeholder="f.eks. Frikadeller med sovs">{{ weekly_menu.thursday if weekly_menu else '' }}</textarea>
          </div>

          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2" for="friday">
              <span class="badge bg-primary rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">5</span>
              Fredag
            </label>
            <textarea id="friday" name="friday" class="form-control rounded-2" rows="2"
              placeholder="f.eks. Suppe med brÃ¸d">{{ weekly_menu.friday if weekly_menu else '' }}</textarea>
          </div>

          <div class="d-flex gap-2 mt-2 pt-3 border-top">
            <button type="submit" class="btn btn-brand rounded-2 px-4">
              ğŸ’¾ Gem personale menu
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Patients Menu -->
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm rounded-3 h-100">
      <div class="card-header bg-accent-1 border-accent-1 rounded-top-3 py-3">
        <h2 class="h5 mb-0">ğŸ¥ Patient Menu</h2>
      </div>
      <div class="card-body p-4">
        <div class="alert alert-info border-0 rounded-3 mb-3">
          <small>ğŸ’¡ Menu for patienter - frokost og aftensmad. Du kan downloade menuen nÃ¥r du har tastet retterne ind og
            vÃ¦lge hvilken farve, du vil have tabellen i.</small>
        </div>

        <!-- Upload/Download Section -->
        <div class="alert alert-light border rounded-3 mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div>
              <div class="fw-semibold mb-1">ğŸ“¤ Upload fra Word-dokument</div>
              <small class="text-muted">Upload ugemenuen direkte fra .docx fil</small>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary rounded-2" data-bs-toggle="modal"
              data-bs-target="#uploadModal">
              VÃ¦lg fil
            </button>
          </div>
          {% if patients_menu %}
          <div class="d-flex align-items-center justify-content-between pt-2 mt-2 border-top">
            <div>
              <div class="fw-semibold mb-1">ğŸ“¥ Download menuplan</div>
              <small class="text-muted">Download nuvÃ¦rende menu som Word-dokument</small>
            </div>
            <div class="d-flex align-items-center gap-2">
              <input type="color" class="form-control form-control-sm form-control-color" id="menuColor" value="#4472C4"
                title="VÃ¦lg menu farve" style="width: 50px; height: 38px;">
              <a href="#" id="downloadMenuBtn" class="btn btn-sm btn-outline-success rounded-2"
                onclick="downloadWithColor(event)">
                Download
              </a>
            </div>
          </div>
          {% endif %}
        </div>

        <script>
          function downloadWithColor(event) {
            event.preventDefault();
            const color = document.getElementById('menuColor').value.replace('#', '');
            const weekString = '{{ patients_menu.week if patients_menu else "" }}';
            const url = `{{ url_for('admin.download_patients_menu', week_string='WEEK_PLACEHOLDER') }}`.replace('WEEK_PLACEHOLDER', weekString) + `?color=${color}`;
            window.location.href = url;
          }
        </script>

        <form method="POST" class="d-flex flex-column gap-3">
          <input type="hidden" name="menu_type" value="patients" />
          <input type="hidden" name="next" value="{{ url_for('admin.menu_input') }}" />

          <!-- Monday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">1</span>
              Mandag
            </label>
            <textarea name="patients_monday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.monday if patients_menu else '' }}</textarea>
            <textarea name="patients_monday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.monday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Tuesday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">2</span>
              Tirsdag
            </label>
            <textarea name="patients_tuesday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.tuesday if patients_menu else '' }}</textarea>
            <textarea name="patients_tuesday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.tuesday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Wednesday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">3</span>
              Onsdag
            </label>
            <textarea name="patients_wednesday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.wednesday if patients_menu else '' }}</textarea>
            <textarea name="patients_wednesday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.wednesday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Thursday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">4</span>
              Torsdag
            </label>
            <textarea name="patients_thursday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.thursday if patients_menu else '' }}</textarea>
            <textarea name="patients_thursday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.thursday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Friday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">5</span>
              Fredag
            </label>
            <textarea name="patients_friday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.friday if patients_menu else '' }}</textarea>
            <textarea name="patients_friday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.friday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Saturday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">6</span>
              LÃ¸rdag
            </label>
            <textarea name="patients_saturday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.saturday if patients_menu else '' }}</textarea>
            <textarea name="patients_saturday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.saturday_dinner if patients_menu else '' }}</textarea>
          </div>

          <!-- Sunday -->
          <div>
            <label class="form-label fw-semibold d-flex align-items-center gap-2 mb-2">
              <span class="badge bg-success rounded-circle"
                style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">7</span>
              SÃ¸ndag
            </label>
            <textarea name="patients_sunday" class="form-control rounded-2 mb-2" rows="2"
              placeholder="Frokost">{{ patients_menu.sunday if patients_menu else '' }}</textarea>
            <textarea name="patients_sunday_dinner" class="form-control rounded-2" rows="2"
              placeholder="Aftensmad">{{ patients_menu.sunday_dinner if patients_menu else '' }}</textarea>
          </div>

          <div class="d-flex gap-2 mt-2 pt-3 border-top">
            <button type="submit" class="btn btn-brand rounded-2 px-4">
              ğŸ’¾ Gem patient menu
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row mt-3">
  <div class="col">
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary rounded-2">
      â† Tilbage til Admin Dashboard
    </a>
  </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content rounded-3 border-0 shadow">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-semibold" id="uploadModalLabel">ğŸ“¤ Upload Patient Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{{ url_for('admin.upload_patients_menu') }}" enctype="multipart/form-data">
        <div class="modal-body px-4 py-3">
          <div class="mb-3">
            <label for="menu_file" class="form-label fw-semibold">VÃ¦lg Word-dokument</label>
            <input type="file" class="form-control rounded-2" id="menu_file" name="menu_file" accept=".docx" required>
            <div class="form-text mt-2">
              Upload et .docx dokument med ugemenuen.
            </div>
          </div>

          <div class="alert alert-info border-0 rounded-3 mb-0">
            <div class="fw-semibold mb-2">âœ… Systemet lÃ¦ser automatisk:</div>
            <ul class="mb-0 small">
              <li>Ugenummer fra dokumentet</li>
              <li>Alle "Varmt" retter for frokost (mandag-sÃ¸ndag)</li>
              <li>Alle "Varmt" retter for aftensmad (mandag-sÃ¸ndag)</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer border-0 pt-0">
          <button type="button" class="btn btn-outline-secondary rounded-2" data-bs-dismiss="modal">Annuller</button>
          <button type="submit" class="btn btn-brand rounded-2">
            ğŸ“¤ Upload menu
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}